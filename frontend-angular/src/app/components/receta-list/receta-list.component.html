<div class="container py-5">
  <div *ngIf="mostrarError && error" class="alert alert-danger alert-dismissible fade show" role="alert">
    <strong>Error:</strong> {{ error }}
    <button type="button" class="btn-close" (click)="mostrarError = false"></button>
  </div>

  <div *ngIf="exito" class="alert alert-success alert-dismissible fade show" role="alert">
    {{ exito }}
    <button type="button" class="btn-close" (click)="exito = null"></button>
  </div>

  <div *ngIf="cargando" class="d-flex justify-content-center my-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Cargando...</span>
    </div>
  </div>

  <div class="row mb-4">
    <div class="col">
      <h1 class="display-4">üç≥ Recetas</h1>
      <p class="text-muted">Listado con filtros, paginaci√≥n y acciones CRUD</p>
    </div>
  </div>

  <div class="card mb-4 shadow-sm">
    <div class="card-header bg-primary text-white">
      <h5 class="mb-0">üîç Filtros</h5>
    </div>
    <div class="card-body">
      <div class="row g-3">
        <div class="col-md-6">
          <input 
            type="text" 
            class="form-control" 
            placeholder="Buscar por nombre o descripci√≥n..."
            [value]="busqueda"
            (input)="busqueda = $any($event.target).value"
            (keyup)="aplicarFiltros()">
        </div>

        <div class="col-md-3">
          <select class="form-select" [value]="categoriaFiltro" (change)="categoriaFiltro = $any($event.target).value">
            <option value="">Todas las categor√≠as</option>
            <option *ngFor="let cat of categorias" [value]="cat">
              {{ cat | titlecase }}
            </option>
          </select>
        </div>

        <div class="col-md-3">
          <button class="btn btn-primary" (click)="aplicarFiltros()">Aplicar</button>
        </div>

        <div class="col-12">
          <button class="btn btn-secondary" (click)="limpiarFiltros()">
            Limpiar filtros
          </button>
        </div>
      </div>
    </div>
  </div>

  <div *ngIf="!cargando && recetasFiltradas.length > 0">
    <div class="row g-4 mb-4">
      <div class="col-md-6 col-lg-4" *ngFor="let receta of recetasPaginadas">
        <div class="card h-100 shadow-sm hover-card">
          <div class="card-body d-flex flex-column">
            <div class="mb-2">
              <span class="badge bg-info ms-1" *ngFor="let cat of receta.categorias">
                {{ cat }}
              </span>
            </div>

            <h5 class="card-title">{{ receta.nombre }}</h5>
            <p class="card-text text-muted small">{{ receta.descripcion | slice:0:80 }}...</p>

            <div class="small text-muted mb-3">
              <div>‚≠ê {{ receta.valoracion.puntuacion }} / 5</div>
              <div>üó≥Ô∏è {{ receta.valoracion.votos }} votos</div>
            </div>

            <div class="btn-group mt-auto" role="group">
              <a [routerLink]="['/receta', receta._id]" class="btn btn-sm btn-outline-primary">
                Ver Detalle
              </a>
              <a [routerLink]="['/editar', receta._id]" class="btn btn-sm btn-outline-warning">
                Editar
              </a>
              <button class="btn btn-sm btn-outline-danger" (click)="eliminarReceta(receta._id)">
                Borrar
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <nav aria-label="Paginaci√≥n" *ngIf="totalPaginas > 1">
      <ul class="pagination justify-content-center">
        <li class="page-item" [class.disabled]="paginaActual === 1">
          <button class="page-link" (click)="cambiarPagina(1)">Primera</button>
        </li>
        <li class="page-item" [class.disabled]="paginaActual === 1">
          <button class="page-link" (click)="cambiarPagina(paginaActual - 1)">Anterior</button>
        </li>

        <li class="page-item" *ngFor="let page of [].constructor(totalPaginas); let i = index"
            [class.active]="i + 1 === paginaActual">
          <button class="page-link" (click)="cambiarPagina(i + 1)">{{ i + 1 }}</button>
        </li>

        <li class="page-item" [class.disabled]="paginaActual === totalPaginas">
          <button class="page-link" (click)="cambiarPagina(paginaActual + 1)">Siguiente</button>
        </li>
        <li class="page-item" [class.disabled]="paginaActual === totalPaginas">
          <button class="page-link" (click)="cambiarPagina(totalPaginas)">√öltima</button>
        </li>
      </ul>
    </nav>

    <div class="text-center text-muted small mt-3">
      Mostrando {{ (paginaActual - 1) * limite + 1 }}-{{ (paginaActual * limite) > recetasFiltradas.length ? recetasFiltradas.length : (paginaActual * limite) }}
      de {{ recetasFiltradas.length }} recetas
    </div>
  </div>

  <div *ngIf="!cargando && recetasFiltradas.length === 0" class="alert alert-info text-center py-5">
    <h4>üòÖ Sin resultados</h4>
    <p>No se encontraron recetas con los filtros aplicados.</p>
    <button class="btn btn-primary" (click)="limpiarFiltros()">Limpiar Filtros</button>
  </div>
</div>
